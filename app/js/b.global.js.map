{"version":3,"names":[],"mappings":"","sources":["b.global.js"],"sourcesContent":["// vars\r\nlet bodyNode = document.body;\r\nlet footer = $(\".page-footer\"),\r\n\twFlag = 0,\r\n\tmenu = $(\".js-menu\"),\r\n\tmainSectionHeight = $(\".main-section\").height();\r\nvar _mask = {\r\n\tonKeyPress: function (cep, event, currentField, options) {\r\n\t\tif (cep == \"\" || cep == \"+\" || cep == \"+7\" || cep == \"+7 8\") {\r\n\t\t\tcurrentField.val(\"+7 \");\r\n\t\t}\r\n\t},\r\n\tclearIfNotMatch: true,\r\n};\r\n\r\n// fn\r\n$.fn.extend({\r\n\tanimateCss: function (animationName) {\r\n\t\tvar animationEnd = \"webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend\";\r\n\t\tthis.addClass(\"animated \" + animationName).one(animationEnd, function () {\r\n\t\t\t$(this).removeClass(\"animated \" + animationName);\r\n\t\t});\r\n\t},\r\n});\r\n\r\nfunction check(form) {\r\n\tlet err = 0;\r\n\tform.find(\"input[data-required=true]\").each(function (index) {\r\n\t\tlet $$ = $(this);\r\n\t\tif ($$.attr(\"type\") == \"checkbox\" && !$$.prop(\"checked\")) {\r\n\t\t\t$$.addClass(\"error\").animateCss(\"flash\");\r\n\t\t\terr++;\r\n\t\t}\r\n\t\tif ($$.attr(\"type\") == \"tel\" && $$.val().length != 16) {\r\n\t\t\t$$.addClass(\"error\").animateCss(\"shake\");\r\n\t\t\terr++;\r\n\t\t} else if ($$.val() == \"\" && $$.attr(\"disabled\") != \"disabled\") {\r\n\t\t\t$$.addClass(\"error\").animateCss(\"shake\");\r\n\t\t\terr++;\r\n\t\t} else $$.removeClass(\"error\");\r\n\t});\r\n\tlet t = $(\".error\", form);\r\n\tif (t.length) {\r\n\t\t$(\"body,html\").animate(\r\n\t\t\t{\r\n\t\t\t\tscrollTop: t.offset().top - 10,\r\n\t\t\t},\r\n\t\t\t700\r\n\t\t);\r\n\t}\r\n\treturn err;\r\n}\r\n\r\nfunction modal(data) {\r\n\t$(\"#modal\").html(data);\r\n\t$(\".modal__frame, #js-overlay\").fadeIn(500);\r\n\t$(\"#js-overlay\").addClass(\"overlay--modal\");\r\n\t$(\"body\").addClass(\"open-modal\");\r\n}\r\n\r\n// plugins\r\n\r\n$(\".mobile-menu\").on(\"click\", function (e) {\r\n\te.preventDefault();\r\n\tif (!$(\".mobile-menu-top\").hasClass(\"open-menu\")) {\r\n\t\t$(\".mobile-menu-top\").addClass(\"open-menu\");\r\n\t\t$(this).addClass(\"open-menu\");\r\n\t\t$(\"html\").addClass(\"lock\");\r\n\r\n\t\t$(this).find(\"span:nth-child(1)\").css({ animation: \"ease 0.7s top forwards\" });\r\n\t\t$(this).find(\"span:nth-child(2)\").css({ animation: \"ease 0.7s scaled forwards\" });\r\n\t\t$(this).find(\"span:nth-child(3)\").css({ animation: \"ease 0.7s bottom forwards\" });\r\n\t} else {\r\n\t\t$(\".mobile-menu-top\").removeClass(\"open-menu\");\r\n\t\t$(this).removeClass(\"open-menu\");\r\n\t\t$(\"html\").removeClass(\"lock\");\r\n\t\t$(this).find(\"span:nth-child(1)\").css({ animation: \"ease 0.7s top-2 forwards\" });\r\n\t\t$(this).find(\"span:nth-child(2)\").css({ animation: \"ease 0.7s scaled-2 forwards\" });\r\n\t\t$(this).find(\"span:nth-child(3)\").css({ animation: \"ease 0.7s bottom-2 forwards\" });\r\n\t}\r\n});\r\n\r\n$(window).scroll(function (e) {\r\n\tif ($(this).scrollTop() > 0) {\r\n\t\t$(\"#scroller\").fadeIn();\r\n\t} else {\r\n\t\t$(\"#scroller\").fadeOut();\r\n\t}\r\n});\r\n\r\n$(\"#scroller\").click(function (e) {\r\n\te.preventDefault();\r\n\t$(\"body,html\").animate({ scrollTop: 0 }, 400);\r\n});\r\n\r\n$(\".mh-head.mm-sticky\").mhead({\r\n\tscroll: {\r\n\t\thide: 200,\r\n\t},\r\n});\r\n\r\n$(\".mh-head:not(.mm-sticky)\").mhead({\r\n\tscroll: false,\r\n});\r\n\r\n// $(\".regions__wrapper\").mCustomScrollbar({\r\n\r\n// \ttheme: \"dark-thick\",\r\n// \taxis: \"x\",\r\n// \tadvanced: {\r\n// \t\tautoExpandHorizontalScroll: true,\r\n// \t},\r\n// });\r\n\r\n$(\".text\").readmore({\r\n\tmoreLink: '<button class=\"spoiler-text btn-border btn-border--white\"><svg viewBox=\"0 0 200 50\"><rect x=\"1\" y=\"0\" fill=\"none\" rx=\"25\" ry=\"25\" width=\"98%\" height=\"100%\"></rect></svg><span>Показать еще</span></button>',\r\n\tlessLink: '<button class=\"spoiler-text btn-border btn-border--white\"><svg viewBox=\"0 0 200 50\"><rect x=\"1\" y=\"0\" fill=\"none\" rx=\"25\" ry=\"25\" width=\"98%\" height=\"100%\"></rect></svg><span>Свернуть</span></button>',\r\n\tcollapsedHeight: 300,\r\n\tspeed: 100,\r\n\r\n\tafterToggle: function (trigger, element, expanded) {\r\n\t\tif ($(element).hasClass(\"readmore-js-collapsed\")) {\r\n\t\t\t$(element).removeClass(\"readmore-js-collapsed\");\r\n\t\t} else {\r\n\t\t\t$(element).addClass(\"readmore-js-collapsed\");\r\n\t\t}\r\n\t},\r\n});\r\n\r\n$(\"select\").niceSelect();\r\n\r\n// $(\"input[type=tel]\").mask(\"+7 000 000-00-00\", _mask);\r\n\r\n// hooks\r\nvar sc = false;\r\n$(document).on(\"scroll\", function () {\r\n\tlet documentScroll = $(this).scrollTop();\r\n\tif (documentScroll > 0) {\r\n\t\tif (!sc) {\r\n\t\t\tmenu.addClass(\"fixed\");\r\n\t\t\tsc = true;\r\n\t\t}\r\n\t} else {\r\n\t\tsc = false;\r\n\t\tmenu.removeClass(\"fixed\");\r\n\t}\r\n});\r\n\r\n$(window).scroll(function () {\r\n\tlet scroll = $(window).scrollTop() + $(window).height();\r\n\tlet offset = footer.offset().top;\r\n\tif (scroll > offset && wFlag == 0) {\r\n\t\t$(\".js-menu\").fadeOut(500);\r\n\t\twFlag = 1;\r\n\t} else if (scroll < offset && wFlag == 1) {\r\n\t\t$(\".js-menu\").fadeIn(500);\r\n\t\twFlag = 0;\r\n\t}\r\n});\r\n\r\n// triggers\r\n$(\".js-menu\").hover(\r\n\tfunction () {\r\n\t\t$(this).addClass(\"active\");\r\n\t\t$(\"#js-overlay\").fadeIn(100);\r\n\t},\r\n\tfunction () {\r\n\t\t$(this).removeClass(\"active\");\r\n\t\t$(\"#js-overlay\").fadeOut(100);\r\n\t}\r\n);\r\n\r\n$(\".smart-scroll\").click(function (e) {\r\n\te.preventDefault();\r\n\tconsole.log();\r\n\r\n\tif ($($(this).attr(\"href\")).length > 0) {\r\n\t\t$(\"body,html\").animate(\r\n\t\t\t{\r\n\t\t\t\tscrollTop: $($(this).attr(\"href\")).offset().top - 100,\r\n\t\t\t},\r\n\t\t\t700\r\n\t\t);\r\n\t} else {\r\n\t\t$(\"body,html\").animate(\r\n\t\t\t{\r\n\t\t\t\tscrollTop: $(\"#area_dates\").offset().top - 100,\r\n\t\t\t},\r\n\t\t\t700\r\n\t\t);\r\n\t}\r\n});\r\n\r\n$(\".js-profile\").on(\"click\", function (e) {\r\n\te.preventDefault();\r\n\tlet $$ = $(this),\r\n\t\tbm = $$.data(\"behavior\");\r\n\tif (bm == \"popup\") {\r\n\t\t$(\"#float-profile\").toggleClass(\"open-profile\");\r\n\t} else {\r\n\t\t$(\"#side-profile\").toggle();\r\n\t}\r\n\t$$.toggleClass(\"open\");\r\n});\r\n\r\n$(\"body\")\r\n\t.on(\"click\", \"#js-overlay, .js-modal-close\", function (e) {\r\n\t\te.preventDefault();\r\n\t\t$(\".modal__frame, #js-overlay\").fadeOut(100);\r\n\t\t$(\"#js-overlay\").removeClass(\"overlay--modal\");\r\n\t\t$(\"body\").removeClass(\"open-modal\");\r\n\t})\r\n\t.on(\"click\", \".trigger-modal\", function (e) {\r\n\t\tvar mode = $(this).data(\"modal\"),\r\n\t\t\tid = $(this).data(\"id\");\r\n\t\tif ($(\"a.js-profile\").length && mode == \"auth\") {\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\te.preventDefault();\r\n\t\t\t// mmenu.close();\r\n\t\t\t$(\".mobile-menu-top\").removeClass(\"open-menu\");\r\n\t\t\t$(\".mobile-menu\").removeClass(\"open-menu\");\r\n\t\t\t$(\"html\").removeClass(\"lock\");\r\n\t\t\t$(\".mobile-menu\").find(\"span:nth-child(1)\").css({ animation: \"ease 0.7s top-2 forwards\" });\r\n\t\t\t$(\".mobile-menu\").find(\"span:nth-child(2)\").css({ animation: \"ease 0.7s scaled-2 forwards\" });\r\n\t\t\t$(\".mobile-menu\").find(\"span:nth-child(3)\").css({ animation: \"ease 0.7s bottom-2 forwards\" });\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"/ajax/\",\r\n\t\t\t\tcache: false,\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tmode: mode + \":get\",\r\n\t\t\t\t\turl: $(this).data(\"url\"),\r\n\t\t\t\t\tid: id,\r\n\t\t\t\t},\r\n\t\t\t\ttype: \"post\",\r\n\t\t\t\tdataType: \"text\",\r\n\t\t\t\tsuccess: function (data) {\r\n\t\t\t\t\tif (data != \"\") modal(data);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\t})\r\n\t.on(\"click\", \".trigger-send\", function (e) {\r\n\t\te.preventDefault();\r\n\t\tlet form = $(this).closest(\"form\"),\r\n\t\t\tresult = $(\"p\", form), overwrite = $(\"#result\");\r\n\t\tif (!check(form)) {\r\n\t\t\t$.ajax({\r\n\t\t\t\turl: \"/ajax/\",\r\n\t\t\t\tcache: false,\r\n\t\t\t\tdata: form.serialize(),\r\n\t\t\t\ttype: \"post\",\r\n\t\t\t\tdataType: \"text\",\r\n\t\t\t\tsuccess: function (response) {\r\n\t\t\t\t\tlet output = JSON.parse(response);\r\n\t\t\t\t\tif (output.result == \"success\") {\r\n\t\t\t\t\t\twindow.location.assign(output.redirect);\r\n\t\t\t\t\t} else if (output.result == \"reload\") {\r\n\t\t\t\t\t\twindow.location.assign(window.location.href);\r\n\t\t\t\t\t} else if (output.result == \"overwrite\") {\r\n\t\t\t\t\t\toverwrite.html(output.overwrite);\r\n\t\t\t\t\t}else {\r\n\t\t\t\t\t\tresult.text(output.reason);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\t})\r\n\t.on(\"click\", \".trigger-wishlist\", function (e) {\r\n\t\te.preventDefault();\r\n\t\tlet $$ = $(this),\r\n\t\t\tc = Number($(\"#user_wishlist_counter\").text());\r\n\t\tif ($$.hasClass(\"favorite-action\")) {\r\n\t\t\t$$.toggleClass(\"liked\");\r\n\t\t\tif ($$.hasClass(\"liked\")) c++;\r\n\t\t\telse c--;\r\n\t\t} else {\r\n\t\t\t$$.parent().toggleClass(\"active\");\r\n\t\t\tif ($$.parent().hasClass(\"active\")) c++;\r\n\t\t\telse c--;\r\n\t\t}\r\n\t\t$(\"#user_wishlist_counter\").text(c);\r\n\t\t$.ajax({\r\n\t\t\turl: \"/ajax/\",\r\n\t\t\tcache: false,\r\n\t\t\tdata: {\r\n\t\t\t\tmode: \"events:wishlist\",\r\n\t\t\t\tguid: $$.data(\"id\"),\r\n\t\t\t},\r\n\t\t\ttype: \"post\",\r\n\t\t\tdataType: \"text\",\r\n\t\t\tsuccess: function (data) {\r\n\t\t\t\tif (data != \"\") modal(data);\r\n\t\t\t},\r\n\t\t});\r\n\t})\r\n\t.on(\"click\", \".trigger-visited\", function (e) {\r\n\t\te.preventDefault();\r\n\t\tlet $$ = $(this),\r\n\t\t\tc = Number($(\"#user_visited_counter\").text());\r\n\t\t$$.parent().toggleClass(\"active\");\r\n\t\tif ($$.parent().hasClass(\"active\")) c++;\r\n\t\telse c--;\r\n\t\t$(\"#user_visited_counter\").text(c);\r\n\t\t$.ajax({\r\n\t\t\turl: \"/ajax/\",\r\n\t\t\tcache: false,\r\n\t\t\tdata: {\r\n\t\t\t\tmode: \"events:visited\",\r\n\t\t\t\tguid: $$.data(\"id\"),\r\n\t\t\t},\r\n\t\t\ttype: \"post\",\r\n\t\t\tdataType: \"text\",\r\n\t\t\tsuccess: function (data) {\r\n\t\t\t\tif (data != \"\") modal(data);\r\n\t\t\t},\r\n\t\t});\r\n\t})\r\n\t.on(\"change\", 'input[name=\"profile[phone][]\"]', function (e) {\r\n\t\tlet $$ = $(this),\r\n\t\t\tcontainer = $$.parent().parent();\r\n\t\tif ($$.val().length < 16 && $$.data(\"saved\")) {\r\n\t\t\tcontainer.remove();\r\n\t\t} else if ($$.val().length == 16 && $$.data(\"new\")) {\r\n\t\t\tlet clone = container.clone();\r\n\t\t\t$(\"input\", clone).val(\"\").mask(\"+7 000 000-00-00\", _mask);\r\n\t\t\tcontainer.after(clone);\r\n\t\t\t$$.attr(\"data-saved\", true);\r\n\t\t}\r\n\t})\r\n\t.on(\"change\", 'input[name=\"profile[email][]\"]', function (e) {\r\n\t\tlet $$ = $(this),\r\n\t\t\tcontainer = $$.parent().parent();\r\n\t\tif ($$.val().length < 1 && $$.data(\"saved\")) {\r\n\t\t\tcontainer.remove();\r\n\t\t} else if ($$.val().length > 1 && $$.data(\"new\")) {\r\n\t\t\tlet clone = container.clone();\r\n\t\t\t$(\"input\", clone).val(\"\");\r\n\t\t\tcontainer.after(clone);\r\n\t\t\t$$.attr(\"data-saved\", true);\r\n\t\t}\r\n\t})\r\n\t.on(\"keyup\", \"#city-input\", function (e) {\r\n\t\tvar v = $(this).val().toLowerCase();\r\n\t\tif (v.length > 0) {\r\n\t\t\t$(\".city-link\").parent().addClass(\"hidden\");\r\n\t\t\t$(\".city-link[data-domain^=\" + v + \"]\")\r\n\t\t\t\t.parent()\r\n\t\t\t\t.removeClass(\"hidden\");\r\n\t\t} else {\r\n\t\t\t$(\".city-link\").parent().removeClass(\"hidden\");\r\n\t\t}\r\n\t});\r\n\r\n$(\"#ajax-reviews\").on(\"click\", \".trigger-more\", function (e) {\r\n\te.preventDefault();\r\n\tlet $$ = $(this),\r\n\t\tcontainer = $$.parent().parent();\r\n\t$$.remove();\r\n\t$(\".review-block__descr\", container).hide();\r\n\t$(\".review-block__full\", container).show();\r\n});\r\n\r\n$(\"#modal\").on(\"click\", \".btn\", function (e) {\r\n\te.preventDefault();\r\n\t$(\".form-signin\").toggleClass(\"form-signin-left\");\r\n\t$(\".form-signup\").toggleClass(\"form-signup-left\");\r\n\t$(\".signup-inactive\").toggleClass(\"signup-active\");\r\n\t$(\".signin-active\").toggleClass(\"signin-inactive\");\r\n\t$(this).removeClass(\"idle\").addClass(\"active\");\r\n});\r\n\r\n$(\"#city-input\").on(\"keyup\", function () {\r\n\tvar value = $(this).val().toLowerCase();\r\n\t$(\"#cities li\").filter(function () {\r\n\t\t$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);\r\n\t});\r\n});\r\n\r\nbodyNode.onload = function () {\r\n\tbodyNode.classList.add(\"endLoad\");\r\n};\r\n\r\n$(window).scroll(function () {\r\n\tif ($(this).scrollTop() > 95) {\r\n\t\t$(\".page-header\").addClass(\"fixed\");\r\n\r\n\t\t$(\".page-header\")\r\n\t\t\t.next()\r\n\t\t\t.css({ \"margin-top\": $(\".page-header\").outerHeight(true) });\r\n\t} else if ($(this).scrollTop() < 1) {\r\n\t\t$(\".page-header\").removeClass(\"fixed\");\r\n\r\n\t\t$(\".page-header\").next().css({ \"margin-top\": \"0px\" });\r\n\t}\r\n});\r\n\r\n// console.log($(\"#debug\").val());\r\n"],"file":"b.global.js"}